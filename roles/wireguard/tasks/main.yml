- name: ğŸ“¦ Install Netfilter Persistent
  tags: [packages, firewall]
  ansible.builtin.apt:
    pkg:
      - netfilter-persistent
    state: present
    update_cache: true

- name: ğŸ”“ Open SMTP Port 25
  tags: [firewall, iptables]
  ansible.builtin.iptables:
    chain: INPUT
    protocol: tcp
    destination_port: 25
    jump: ACCEPT
    action: insert

- name: ğŸ’¾ Save Iptables Rules
  tags: [firewall, iptables]
  ansible.builtin.command: netfilter-persistent save
  register: wireguard_iptables_save
  changed_when: wireguard_iptables_save.rc == 0

- name: ğŸ“ Create Docker Compose Data Directory
  tags: [docker, data]
  ansible.builtin.file:
    path: "{{ common_docker_compose_data_dir }}"
    state: directory
    mode: "0755"

- name: ğŸ“ Copy ddclient Configuration
  tags: [docker, ddclient]
  ansible.builtin.copy:
    src: files/ddclient
    dest: "{{ common_docker_compose_data_dir }}"
    mode: "0755"

- name: ğŸ”‘ Copy Wireguard Secrets
  tags: [docker, wireguard]
  ansible.builtin.copy:
    src: secrets/wireguard
    dest: "{{ common_docker_compose_data_dir }}"
    mode: "0755"
