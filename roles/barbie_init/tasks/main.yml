- name: ğŸ“š Load Borg Configuration Vars
  tags: [borgmatic, config]
  ansible.builtin.include_vars: ../../barbie/vars/main.yml

- name: ğŸ—ï¸ Initialize Borgmatic Repositories
  tags: [borgmatic, init]
  community.docker.docker_container_exec:
    container: borgmatic
    command: |
      /bin/sh -c "export SMTP_PASSWORD=$(cat /run/secrets/smtp_password) && \
      borgmatic repo-create \
        --encryption repokey \
        --repository /mnt/repository/{{ item.key }}"
  with_items: "{{ barbie_borg_configs | dict2items }}"
