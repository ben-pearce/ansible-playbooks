- name: ğŸ”„ Refresh Apt Cache
  tags: [packages, apt]
  ansible.builtin.apt:
    update_cache: true
  register: common_result
  until: common_result is not failed
  delay: 6
  retries: 10

- name: ğŸ“¦ Install System Packages
  tags: [packages, apt]
  ansible.builtin.apt:
    pkg:
      - python3-paramiko
    state: present
    update_cache: true
  register: common_result
  until: common_result is not failed
  delay: 6
  retries: 10

- name: ğŸ—ï¸ Copy SSH Host Keys
  tags: [ssh, security]
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: /etc/ssh
    owner: root
    group: root
    mode: "{{ '0644' if item.endswith('.pub') else '0600' }}"
  with_fileglob:
    - ../../{{ inventory_hostname }}/secrets/ssh_host_keys/*
