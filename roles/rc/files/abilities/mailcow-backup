#!/bin/bash
set -euo pipefail

mode="$1"

backup_dir="/mnt/data/applications/mailcow"

if [[ -z "$mode" ]]; then
    echo "Usage: $0 <create|clean>"
    exit 1
fi

case "$mode" in
    create)
        MAILCOW_BACKUP_LOCATION="$backup_dir" \
            "$COMPOSE_REPOSITORY"/mailcow/helper-scripts/backup_and_restore.sh \
            backup all
        ;;
    clean)
        if [[ -d "$backup_dir" ]]; then
            rm -rf "${backup_dir:?}/"*
        else
            echo "Backup directory does not exist: $backup_dir"
            exit 1
        fi
        ;;
    *)
        echo "Unknown mode: $mode"
        exit 1
        ;;
esac
